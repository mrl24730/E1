var UploadObj={};$(document).ready(function(){$("input[type=submit], a.btnDownload, button").button();$("input:text").button().addClass("ui-textfield");
$("#FormSearch").submit(function(b){if($.trim($("#WarrantyNum").val())!=""||$.trim($("#CaseNum").val())!=""||$.trim($("#Phone").val())!=""){var a=$(this).serializeArray();
$.ajax({type:"POST",url:"api/getSearchWarranty.ashx",data:a}).success(function(c){console.log(c);if(c.status===1){$(".tbl_searchResult tbody").empty();
var g=c.data;if(g.length>0){for(var d=0;d<g.length;d++){var f=g[d];var e=$(".template tr").clone();$.each(f,function(h,i){e.find(".Res"+h).text(i);});e.find(".ResName").text(f.Title+" "+f.Name);
e.find(".ResDop").text(f.Dop.split("T")[0]);e.find(".ResCountryCity").text(f.Country+" / "+f.City);e.find(".ResCreateDate").text(f.CreateDate.replace("T","  "));
if(!f.CaseNum){e.find(".ResCaseNum").text("N.A.");}if(!f.Email){e.find(".ResEmail").text("N.A.");}$(".tbl_searchResult tbody").append(e);}}else{}}else{if(c.status===2){}else{if(c.status===3){}else{}}}});
}b.preventDefault();});$("#FormUpload").submit(function(f){var b=$("input[name=SettingType]:checked","#FormUpload").val();var a=$("#FileUpload").val();
if(b!=""&&a!=""){var d=new FormData();var c=$("#FileUpload").get(0).files;d.append("SettingType",b);if(c.length>0){d.append("FileUpload",c[0]);}$.ajax({type:"POST",url:"api/uploadWarrantySetting.ashx",contentType:false,processData:false,data:d}).success(function(g){var e="";
var i="";var h={resizable:false,height:140,modal:false};if(g.status==1){$("#consolePanel").empty();UploadObj.Guid=g.data.Guid;UploadObj.Type=g.data.Type;
e='These have <b class="number">{num}</b> rows will be insert to Database. Are you sure?';e=e.replace("{num}",g.data.Total);h.title="Adding new "+g.data.Type;
h.buttons={Okay:function(){processXlsData();$(this).dialog("close");},Cancel:function(){$(this).dialog("close");}};}else{if(g.status==2){h.title="Unable to save file";
h.buttons={Okay:function(){$(this).dialog("close");}};}else{if(g.status==3){h.title="Incorrect file format";e="Please upload a proper xls or xlsx file";
h.buttons={Okay:function(){$(this).dialog("close");}};}else{if(g.status==4){h.title="Missing file";h.buttons={Okay:function(){$(this).dialog("close");}};
}else{if(g.status==5){h.title="Session timeout";h.buttons={Reload:function(){location.reload();$(this).dialog("close");}};}}}}}$("#dialog-confirm .txt").html(e);
$("#dialog-confirm").dialog(h);});}f.preventDefault();});$(".datepicker").datepicker({dateFormat:"yy-mm-dd",maxDate:0});$(".btnDownload").click(function(b){if($("#txtFrom").val()!=""&&$("txtTo").val()!=""){var a="api/getWarrantyRegistration.ashx?From={From}&To={To}";
a=a.replace("{From}",$("#txtFrom").val());a=a.replace("{To}",$("#txtTo").val());$(this).attr("href",a);}else{b.preventDefault();}});$("#SettingsGroup").buttonset();
});function processXlsData(){UploadObj.status="Processing";var a={Status:"Start",Guid:UploadObj.Guid,Type:UploadObj.Type};$.ajax({type:"POST",url:"api/processStatus.ashx",dataType:"json",data:a}).success(function(b){if(b.status==1){$("#consolePanel").append($("<p/>").text("Starting Process...."));
}else{if(b.status==2){}else{if(b.status==3){}else{}}}});monitorXlsData();}var intervalMonitor;function monitorXlsData(){intervalMonitor=setInterval(intervalMonitorFN,2000);
}function intervalMonitorFN(){if(UploadObj.status=="Processing"){var a={Status:"Monitor"};$.ajax({type:"POST",url:"api/processStatus.ashx",dataType:"json",data:a}).success(function(b){if(b.status==1){var c="";
switch(b.data.status){case"Processing":if(b.data.current==0&&b.data.ttl==0){c="Reading Excel file";}else{c="Processing {current} / {ttl}...";c=c.replace("{current}",b.data.current);
c=c.replace("{ttl}",b.data.ttl);}break;case"Error":UploadObj.status="Error";c="Something Error near row {current} , Please check the excel file";c=c.replace("{current}",b.data.current);
c=c.replace("{ttl}",b.data.ttl);break;case"Complete":UploadObj.status="Complete";c="Process Completed";break;}$("#consolePanel").append($("<p/>").text(c));
}});}else{clearInterval(intervalMonitor);}}